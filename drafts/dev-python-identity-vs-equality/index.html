<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-118286402-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-118286402-1');
  </script>

      <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />

    <title>Raúl Negrón's Website</title>

    <meta charset="utf-8" />
    <link href="https://raulnegron.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Raúl Negrón's Website Full Atom Feed" />
    <link href="https://raulnegron.me/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate" title="Raúl Negrón's Website Categories Atom Feed" />

    <link rel="canonical" href="https://raulnegron.me/drafts/dev-python-identity-vs-equality"/>

    <link rel="stylesheet" href="https://raulnegron.me/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://raulnegron.me/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://raulnegron.me/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
    <link rel="stylesheet" href="https://raulnegron.me/theme/css/styles.css"/>



    <meta name="tags" contents="python" />
    <meta name="tags" contents="django" />
    <meta name="tags" contents="programming" />

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://raulnegron.me/theme/img/profile.png"/>
    </div>
  </div>

  <nav class="sidebar-nav">
  <a class="sidebar-nav-item" href="https://raulnegron.me/">main page</a>
      <a class="sidebar-nav-item" href="https://raulnegron.me/about">about&nbsp;me</a>
      <a class="sidebar-nav-item" href="https://raulnegron.me/reading">reading&nbsp;list</a>

      <a class="sidebar-nav-item" href="https://raulnegron.me/blog.html">blog</a>


  <a class="sidebar-nav-item" href="https://github.com/rnegron" target="_blank">github</a>
  <a class="sidebar-nav-item" href="https://www.linkedin.com/in/raulnegron/" target="_blank">linkedin</a>
  </nav>

  <div class="sidebar-item">
    <p>Site written in <a href="https://daringfireball.net/projects/markdown/">Markdown</a>, generated by <a href="http://docs.getpelican.com/en/stable/">Pelican</a>, hosted on <a href="https://pages.github.com/">Github Pages</a> and registered using <a href="https://aws.amazon.com/route53/">Route 53</a>.</p>
    <p class="tiny-note">
      <a class="muted" href="https://github.com/thomaswilley/pelicanyan">theme: modified pelicanyan v0.1</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://raulnegron.me/" title="Home">Raúl Negrón's Website</a>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Identity and Equality in&nbsp;Python
    </h1>
    <span class="post-date">July 22, 2018</span>

    <p>I would consider <a href="https://www.python.org/">Python</a> to be the programming language I&#8217;m most comfortable writing code in. There&#8217;s plenty to love, and one of its more recognizable features is the simple to read <a href="https://en.wikipedia.org/wiki/Python_syntax_and_semantics">syntax</a>. I&#8217;ve heard the phrase &#8220;executable pseudocode&#8221; thrown around before, and although I would not go that far, its easy to see where the comparisons come&nbsp;from. </p>
<p>A great side effect of sporting such a relatively simple to understand syntax is its <a href="https://www.economist.com/science-and-technology/2018/07/21/python-has-brought-computer-programming-to-a-vast-new-audience">mass appeal</a>, with people jumping in with little programming knowledge and using Python to jump start their new coding&nbsp;adventures. </p>
<p>It&#8217;s not hard to get carried away and forget that, despite the focus on readability, code is not the same as prose. Its always worthwhile to keep the subtleties of a particular language in mind. That being said,   this post is about the bug I created when I forgot about the very important distinction between identity and equality in&nbsp;Python.</p>
<p>Let&#8217;s review the fundamentals before diving into the&nbsp;particulars.</p>
<h1>Object&nbsp;Equality</h1>
<p>Object equality refers to the intuitive notion of equality from mathematics. Sound simple&nbsp;enough. </p>
<div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">x</span> <span class="o">==</span> <span class="n">y</span>  <span class="c1"># True</span>
</pre></div>


<p>The equality operator is part of Python&#8217;s built-in <a href="https://docs.python.org/3/library/stdtypes.html?highlight=comparison#comparisons">comparison operators</a>.</p>
<p>From the docs, we see that <em>&#8220;objects of different types, except different numeric types, never compare equal.&#8221;</em> We can test this out as&nbsp;follows:</p>
<div class="highlight"><pre><span></span><span class="c1"># Comparison between objects of different types, one non-numeric</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="n">x</span> <span class="o">==</span> <span class="n">y</span>  <span class="c1"># False, x and y are different objects</span>

<span class="c1"># Comparison between different numeric types</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># &lt;class &#39;int&#39;&gt;</span>
<span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># &lt;class &#39;float&#39;&gt;</span>
<span class="n">x</span> <span class="o">==</span> <span class="n">y</span>   <span class="c1"># True</span>
</pre></div>


<p>We can also define equality on our own objects, of&nbsp;course:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Goomba</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Goomba is equal to other if the sum of their values is even </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">class</span> <span class="nc">Koopa</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Koopa is equal to other if the sum of their values is odd</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="n">goombario</span> <span class="o">=</span> <span class="n">Goomba</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">goombella</span> <span class="o">=</span> <span class="n">Goomba</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">kooper</span> <span class="o">=</span> <span class="n">Koopa</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">koops</span> <span class="o">=</span> <span class="n">Koopa</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">goombella</span> <span class="o">==</span> <span class="n">goombario</span>  <span class="c1"># False, 1 + 2 = 3, 3 % 2 = 1</span>
<span class="n">goombario</span> <span class="o">==</span> <span class="n">goombario</span>  <span class="c1"># True,  1 + 1 = 2, 2 % 2 = 0</span>

<span class="n">goombario</span> <span class="o">==</span> <span class="n">kooper</span>     <span class="c1"># True,  1 + 1 = 2, 2 % 2 = 0</span>
<span class="n">goombella</span> <span class="o">==</span> <span class="n">kooper</span>     <span class="c1"># False, 2 + 1 = 3, 3 % 2 = 1</span>
<span class="n">goombella</span> <span class="o">==</span> <span class="n">koops</span>      <span class="c1"># True,  2 + 2 = 4, 4 % 2 = 0</span>
</pre></div>


<p>You may have noticed something peculiar from the above example: due to the way equality was defined in the above classes, the operand order matters (the operation is not symmetric in this&nbsp;case).</p>
<div class="highlight"><pre><span></span><span class="n">goombella</span> <span class="o">==</span> <span class="n">kooper</span>     <span class="c1"># False, 3 % 2 = 1 (odd for Goomba = false)</span>
<span class="n">kooper</span> <span class="o">==</span> <span class="n">goombella</span>     <span class="c1"># True,  3 % 2 = 1 (odd for Koopa = true)</span>
</pre></div>


<p><a href="https://en.wikipedia.org/wiki/Syntactic_sugar">Syntactic sugar</a> is to blame. You can read more <a href="https://docs.python.org/3/reference/datamodel.html#object.__eq__">here</a>. </p>
<p>Digging a bit further, we can see from the <a href="https://docs.python.org/3/reference/expressions.html#value-comparisons">value comparisons for expressions</a> page on the official docs that it is intended for the <code>==</code> operator to be a test for an <a href="https://en.wikipedia.org/wiki/Equivalence_relation">equivalence relation</a>. So the above example, where symmetry is not observed, would not be consistent with the way Python defines equality. In any case, object equality is pretty straightforward from a practical point of&nbsp;view.</p>
<h1>Object&nbsp;Identity</h1>
<p>For me, the notion of &#8220;identity&#8221; is a bit more vague than &#8220;equality&#8221;. What does it mean for two objects to share an identity? While perhaps not as intuitive as object equality, object identity is not much more complicated. In Python, identity is determined with the <code>is</code> <a href="https://docs.python.org/3/reference/expressions.html#is">operator</a>.</p>
<p>Basically, <code>a is b</code> if and only if <code>id(a) == id(b)</code>, where <code>id(x)</code> is <a href="https://docs.python.org/3/library/functions.html#id">the memory address of x</a>. So, for two objects to be &#8220;identical&#8221;, it must be the case that they are the same exact&nbsp;object. </p>
<div class="highlight"><pre><span></span><span class="mi">1</span> <span class="ow">is</span> <span class="mi">1</span>  <span class="c1"># True</span>


<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">x</span> <span class="o">==</span> <span class="n">y</span>  <span class="c1"># True</span>
<span class="n">x</span> <span class="ow">is</span> <span class="n">y</span>  <span class="c1"># False</span>
</pre></div>


<p>There are some subtleties to this that may not be immedietely apparent. For example, <code>[1, 2, 3] is [1, 2, 3]</code> = <code>False</code>. Meanwhile, <code>(1, 2, 3) is (1, 2, 3)</code>. The reason is, as you may suspect, that <a href="https://docs.python.org/3/library/stdtypes.html?highlight=comparison#lists">lists</a> are mutable while <a href="https://docs.python.org/3/library/stdtypes.html?highlight=comparison#tuples">tuples</a>.</p>
<h1>Equality vs Identity in Python&nbsp;Strings</h1>
<p>But what about strings? We know that strings are immutable. And as we might expect, <code>'hello, world' is 'hello, world'</code> = <code>True</code>! </p>
<h2><code>is</code> is not <code>==</code></h2>
<p>Working with <a href="https://www.djangoproject.com/">Django</a> and the <a href="http://www.django-rest-framework.org/">Django <span class="caps">REST</span> framework</a> package, I was writing a class which inherited from <code>restframe.views.ModelView</code>, </p>
<p>I created a <code>django.db.models</code> instance</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="n">models</span><span class="o">.</span><span class="n">CharField</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;database_x&#39;</span>
</pre></div>


<p>Here&#8217;s what I should have&nbsp;written:</p>
<div class="highlight"><pre><span></span><span class="n">models</span><span class="o">.</span><span class="n">CharField</span> <span class="o">!=</span> <span class="s1">&#39;database_x&#39;</span>
</pre></div>


<p>Enter&#8230;</p>
<h2>String&nbsp;Interment</h2>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="nb">intern</span>

<span class="n">test_string</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span>
</pre></div>


<h1>Conclusion</h1>
  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>
     </div>
  </body>
</html>